<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>diskografie — b3nn3t</title>
<meta content="diskografie — b3nn3t" name="description"/>
<link href="favicon.svg" rel="icon" type="image/svg+xml"/>

<!-- Haupt-Styles -->
<link href="styles.css" rel="stylesheet"/>
<link href="styles_nav_arrows.css" rel="stylesheet"/>
<link href="swipe-helper.css" rel="stylesheet"/>

<style>
  :root {
    --header-height: 56px;
    --title-top: clamp(21px, 3vw, 31px);
    --title-left: clamp(21px, 3vw, 31px);
    --title-space: 150px;
    --title-size: 2.6rem;
  }

  html, body { height: 100%; overflow: hidden; margin: 0; }

  .main {
    position: relative;
    height: calc(100vh - var(--header-height));
    background: rgba(255,255,255,.32);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
    border-radius: 12px;
  }

  .title-fixed {
    position: absolute;
    top: var(--title-top);
    left: var(--title-left);
    right: var(--title-left);
    z-index: 3;
  }

  .title-fixed h1 {
    margin: 0;
    font-weight: 700;
    line-height: 1.1;
    color:#111;
  }

  .title-fixed p {
    margin: .6rem 0 0 0;
    color:#333;
  }

  .scroll-panel {
    position: absolute;
    top: calc(var(--title-top) + var(--title-space));
    left: var(--title-left);
    right: var(--title-left);
    bottom: 16px;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    background: transparent !important;
    scrollbar-width: none;
  }

  .scroll-panel::-webkit-scrollbar{ display:none; }

  .disco-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px,1fr));
    gap: 1rem;
    margin: 0 0 2rem;
    align-items: start;
  }

  .release {
    border:1px solid #ddd;
    border-radius:12px;
    padding:12px;
    box-shadow:0 1px 3px rgba(0,0,0,.06);
    background:#fff;
  }

  .release img {
    width:100%;
    height:220px;
    object-fit:cover;
    border-radius:8px;
    background:#f2f2f2;
  }

  .release .meta { font-size:.9rem; color:#444; margin-top:.5rem }
  .release .title { font-weight:600 }

  .toggle {margin-top:.5rem}
  .toggle button {
    border:1px solid #111;
    border-radius:999px;
    padding:.35rem .7rem;
    font-weight:600;
    background:#111;
    color:#fff;
    cursor:pointer;
  }

  .tracklist {margin-top:.6rem;display:none}
  .tracklist.open{display:block}
  .tracklist iframe{width:100%;height:352px;border:0;border-radius:8px}

  @media (max-width:768px){
    .title-fixed p{ font-size:1rem; }
    .scroll-panel{ bottom:8px; }
    main.main{
      min-height: calc(100dvh - var(--header-height) - 20px);
      height: calc(100dvh - var(--header-height) - 20px);
    }
  }
</style>
</head>

<body>
<header class="header">
  <a aria-label="b3nn3t Home" class="brand" href="index.html">
    <img alt="" src="favicon.svg"/><strong>b3nn3t</strong>
  </a>
</header>

<a aria-label="Vorherige Seite" class="nav-arrow left" href="ueber-mich.html">←</a>
<a aria-label="Nächste Seite" class="nav-arrow right" href="kontakt.html">→</a>

<main class="main">
  <div class="title-fixed">
    <h1>diskografie</h1>
    <p>meine releases & kollabos</p>
  </div>

  <div class="scroll-panel">
    <!-- Beispiel-Inhalt -->
    <section>
      <div class="panel-block"><h3>Singles (inkl. Kollabos)</h3></div>
      <div class="disco-grid">
        <article class="release">
          <img class="cover" alt="Cover: mani matter (mit XYZ)"
               data-spotify="https://open.spotify.com/track/2Xp7qD73hYkVhxdjTYbepU"
               loading="lazy"/>
          <div class="title"><a href="https://open.spotify.com/track/2Xp7qD73hYkVhxdjTYbepU" target="_blank" rel="noopener">mani matter (mit XYZ)</a></div>
          <div class="meta">2025</div>
        </article>

        <article class="release">
          <img class="cover" alt="Cover: oder auch in fabeln"
               data-spotify="https://open.spotify.com/track/1ucICLXPSxrr8RYZqTxbdR"
               loading="lazy"/>
          <div class="title"><a href="https://open.spotify.com/track/1ucICLXPSxrr8RYZqTxbdR" target="_blank" rel="noopener">oder auch in fabeln</a></div>
          <div class="meta">2025</div>
        </article>
      </div>
    </section>
  </div>
</main>

<a aria-label="Zur Startseite" class="home-btn" href="index.html">Startseite</a>

<!-- ==================== OPTIMIERTER COVER-LOADER ==================== -->
<script>
(function () {
  const FALLBACK_SRC = 'assets/placeholder-cover.jpg';
  const DELAY_MS = 150;           // Pause zwischen Requests
  const PREFETCH_MARGIN = '200px'; // Lazy-Load Vorpuffer

  async function fetchCoverUrl(spotifyUrl){
    try {
      const res = await fetch(
        `https://open.spotify.com/oembed?url=${encodeURIComponent(spotifyUrl)}`,
        { mode: 'cors', cache: 'force-cache' }
      );
      if (!res.ok) throw new Error('oEmbed failed');
      const data = await res.json();
      return (data.thumbnail_url || '').replace(/&?size=\d+/, '');
    } catch {
      return null;
    }
  }

  async function setCover(img){
    const local = img.dataset.local; // Lokaler Cache (optional)
    if (local) { img.src = local; return; }
    const url = img.dataset.spotify;
    if (!url) { img.src = FALLBACK_SRC; return; }
    const src = await fetchCoverUrl(url);
    img.src = src || FALLBACK_SRC;
  }

  // --- Request-Queue (seriell & throttled) ---
  const queue = [];
  let running = false;
  async function runQueue(){
    if (running) return;
    running = true;
    while (queue.length){
      const job = queue.shift();
      await job();
      await new Promise(r => setTimeout(r, DELAY_MS));
    }
    running = false;
  }

  function schedule(img){
    queue.push(() => setCover(img));
    runQueue();
  }

  // --- Initialisierung ---
  function initCovers(){
    const imgs = Array.from(document.querySelectorAll('img.cover[data-spotify]'));
    if ('IntersectionObserver' in window){
      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting){
            io.unobserve(entry.target);
            schedule(entry.target);
          }
        });
      }, { rootMargin: PREFETCH_MARGIN });
      imgs.forEach(img => io.observe(img));
    } else {
      imgs.forEach(schedule);
    }
  }

  if (document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initCovers);
  else
    initCovers();
})();
</script>

<!-- ================================================================ -->
</body>
</html>
