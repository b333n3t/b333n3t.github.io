<!-- Öffnet Video direkt unter der Karte (volle Breite) + Schließen -->
<script>
  const cards = document.querySelectorAll('.card[data-embed-src]');

  function closeAllVideos() {
    document.querySelectorAll('.video-row').forEach(row => row.remove());
  }

  cards.forEach(card => {
    card.addEventListener('click', () => {
      const next = card.nextElementSibling;
      if (next && next.classList.contains('video-row')) { next.remove(); return; }
      closeAllVideos();

      const row = document.createElement('div');
      row.className = 'video-row';

      const wrapper = document.createElement('div');
      wrapper.className = 'video-wrapper';

      const closeBtn = document.createElement('button');
      closeBtn.textContent = '×';
      closeBtn.className = 'video-close';
      closeBtn.addEventListener('click', (e) => { e.stopPropagation(); row.remove(); });

      const src = card.getAttribute('data-embed-src');
      if (src.endsWith('.mp4')) {
        const video = document.createElement('video');
        video.src = src;
        video.controls = true;
        video.autoplay = true;
        video.style.width = '100%';
        video.style.height = '100%';
        wrapper.appendChild(closeBtn);
        wrapper.appendChild(video);
      } else {
        const iframe = document.createElement('iframe');
        iframe.src = src;
        iframe.allowFullscreen = true;
        iframe.loading = 'lazy';
        iframe.title = 'Video';
        // ⬇️ NEU: Falls YouTube, echten Titel setzen
        const m = src.match(/\/embed\/([a-zA-Z0-9_-]{6,})/);
        if (m && window.YT_TITLES && window.YT_TITLES[m[1]]) {
          iframe.title = window.YT_TITLES[m[1]];
        }
        wrapper.appendChild(closeBtn);
        wrapper.appendChild(iframe);
      }

      row.appendChild(wrapper);
      card.parentNode.insertBefore(row, card.nextSibling);
      card.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });
  });

  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeAllVideos(); });
</script>

<!-- Instagram Thumbnails -->
<script>
  (function () {
    const map = {
      video1: 'assets/insta1.png',
      video2: 'assets/insta2.png',
      video3: 'assets/insta3.png',
      video4: 'assets/insta4.png',
      video5: 'assets/insta5.png',
      video6: 'assets/insta6.png'
    };
    Object.entries(map).forEach(([id, src]) => {
      const card = document.getElementById(id);
      if (!card || card.querySelector('img.thumb')) return;
      const img = new Image();
      img.loading = 'lazy'; img.decoding = 'async';
      img.className = 'thumb'; img.alt = 'Instagram-Vorschau';
      img.src = src;
      img.onerror = () => { img.onerror = null; img.src = 'assets/instagram_poster.jpg'; };
      card.insertBefore(img, card.firstChild);
    });
  })();
</script>

<!-- YouTube Thumbnails -->
<script>
  (function () {
    const map = {
      yt1: { file: 'assets/reel1.avif', id: 'ZSaj_FuqPN8' },
      yt2: { file: 'assets/reel2.avif', id: 'DMNl40Tip1w' },
      yt3: { file: 'assets/reel3.avif', id: 'K5pKG0Smdfc' },
      yt4: { file: 'assets/reel4.jpg',  id: '4I9vlcGvFGQ' },
      yt5: { file: 'assets/reel5.avif', id: 'w0pNdnlb96M' },
      yt6: { file: 'assets/reel6.avif', id: 'rV1U891RKLo' },
      yt7: { file: 'assets/reel7.avif', id: 'fq8zhAQMam0' }
    };

    Object.entries(map).forEach(([id, cfg]) => {
      const card = document.getElementById(id);
      if (!card || card.querySelector('img.thumb')) return;

      const img = new Image();
      img.loading = 'lazy'; img.decoding = 'async';
      img.className = 'thumb'; img.alt = 'YouTube-Vorschau';
      img.src = cfg.file;
      img.onerror = () => {
        img.onerror = null;
        img.src = `https://img.youtube.com/vi/${cfg.id}/hqdefault.jpg`;
      };
      card.insertBefore(img, card.firstChild);
    });
  })();
</script>

<!-- 🆕 YouTube Titel automatisch holen -->
<style>
  .grid-seen .card .yt-title {
    display:block;
    margin-top:4px;
    font-size:.95rem;
    font-weight:600;
  }
</style>
<script>
  window.YT_TITLES = {};
  (function () {
    const ytCards = Array.from(document.querySelectorAll('.card[data-embed-src*="youtube.com/embed/"]'));
    const getId = (src) => {
      const m = (src||'').match(/\/embed\/([a-zA-Z0-9_-]{6,})/);
      return m ? m[1] : null;
    };
    ytCards.forEach(async (card) => {
      const src = card.getAttribute('data-embed-src');
      const id = getId(src);
      if (!id) return;
      try {
        const url = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`;
        const res = await fetch(url, { mode: 'cors' });
        if (!res.ok) throw new Error('oEmbed fail');
        const data = await res.json();
        window.YT_TITLES[id] = data.title || '';
        let t = card.querySelector('.yt-title');
        if (!t) {
          t = document.createElement('span');
          t.className = 'yt-title';
          card.appendChild(t);
        }
        t.textContent = window.YT_TITLES[id];
      } catch (e) {
        // falls kein Netz / blockiert: ignorieren
      }
    });
  })();
</script>

<!-- Intro Thumbnail -->
<script>
  (function () {
    const intro = document.getElementById('introVideo');
    if (!intro || intro.querySelector('img.thumb')) return;
    const img = new Image();
    img.loading = 'lazy'; img.decoding = 'async';
    img.className = 'thumb'; img.alt = 'Intro-Vorschau';
    img.src = 'assets/Intro.jpg';
    img.onerror = () => { img.onerror = null; img.src = 'assets/intro.jpg'; };
    intro.insertBefore(img, intro.firstChild);
  })();
</script>
